---
// https://medium.com/fredwong-it/aws-s3-no-access-control-allow-origin-header-is-present-on-the-requested-resource-ce755b657931
// https://krpano.com/examples/?maps&version=122
import type { MarkdownLayoutProps } from "astro";
const title = "360&deg; photo";

type Props = MarkdownLayoutProps<{
  author: string;
  date: string;
  title: string;
  previewUrl: string;
  photoUrl: string;
  isDraft: boolean;
}>;

const { frontmatter } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.css"
    />
    <script is:inline type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three/build/three.module.js",
          "@photo-sphere-viewer/core": "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.module.js",
          "@photo-sphere-viewer/gyroscope-plugin": "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gyroscope-plugin@5/index.module.js"
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #000;
      }
      #viewer {
        width: 100%;
        height: 100%;
      }
      .psv-navbar {
        background: red !important;
      }
    </style>
  </head>
  <body>
    <!-- Контейнер для Photo Sphere Viewer -->
    <div id="viewer"></div>

    <script is:inline type="module" define:vars={{ frontmatter }}>
      import { Viewer } from "@photo-sphere-viewer/core";
      import { GyroscopePlugin } from "@photo-sphere-viewer/gyroscope-plugin";

      // var h = (window.screen.availHeight * 5) / 6;
      // var w = (window.screen.availWidth * 5) / 6;

      // const h = window.screen.availHeight;
      // const w = window.screen.availWidth;

      const h = document.documentElement.clientHeight;
      const w = document.documentElement.clientWidth;

      document.getElementById("viewer").style.width = `${w}px`;
      document.getElementById("viewer").style.height = `${h}px`;
      // const viewer =
      new Viewer({
        container: document.querySelector("#viewer"),
        // panorama: "https://storage.clo.ru/s3-masle-net-default-bucket/Samui_Villa_291224.JPG",
        panorama: frontmatter.photoUrl,
        caption: frontmatter.title,
        plugins: [GyroscopePlugin],
      });
    </script>
  </body>
</html>
